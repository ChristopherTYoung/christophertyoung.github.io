<!DOCTYPE html>
<html>

<head>
    <title>Make a Post</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="finalproject.css" />
</head>

<body>

    <section class="titleblock">
        <header>
            <h1 class="websitetitle">Chris's Blog</h1>
        </header>
        <nav>
            <a class="navigation" href="index.html">Home</a>
            <a class="navigation" href="about_me.html">About Me</a>
            <a class="navigation" href="my_adventures.html">My Adventures</a>
        </nav>
        <div class="dropdown">
            <button class="dropbtn">Menu</button>
            <div class="dropdowncontent">
                <a href="index.html">Home</a>
                <a href="about_me.html">About Me</a>
                <a href="my_adventures.html">My Adventures</a>
            </div>
    </section>
    <div id="post" class="contentdiv">
        <h1>Make a Post</h1>
        <p>Title</p>
        <!-- REQUIREMENT #2 - HTML Attribute 8 type -->
        <input id="title" type="text" />
        <br>
        <p>Write here</p>
        <textarea id="postcontent" placeholder="Write your post here" minlength="20" maxlength="500"></textarea>
        <form>
            <!-- REQUIREMENT #2 - HTML Attribute 9 name and Attribute 10 value -->
            <input class="draft" type="radio" name="posttype" value="draft"> Draft
            <br><input class="draft" type="radio" name="posttype" value="notdraft"> Not a Draft
        </form>
        <hr>
        <button id="authorize">Authorize</button>
        <button id="submitpost" type="submit">Submit</button>
    </div>
    <footer>Chris's Blog 2022
        <br><a class="postlink" href="post.html">Post</a>
    </footer>
    <script src="https://apis.google.com/js/api.js"></script>
    <script>
        // REQUIREMENT #11 - a JavaScript class
        class GoogleAPI {
            // Free to use code from the google api
            authenticate() {
                return gapi.auth2.getAuthInstance()
                    .signIn({ scope: "https://www.googleapis.com/auth/blogger" })
                    .then(function () { console.log("Sign-in successful"); clientIsLoaded = true; },
                        function (err) { console.error("Error signing in", err); });
            }
            loadClient() {
                gapi.client.setApiKey("AIzaSyDu3W_cZdzG7-U9B4mcTNy_L3WsCKVY7BM");
                return gapi.client.load("https://content.googleapis.com/discovery/v1/apis/blogger/v3/rest")
                    .then(function () { console.log("GAPI client loaded for API"); },
                        function (err) { console.error("Error loading GAPI client for API", err); });
            }
            execute(title, content, draft) {
                return gapi.client.blogger.pages.insert({
                    "blogId": "7348106859157198878",
                    "isDraft": false,
                    "resource": {
                        "title": "test 3",
                        "content": "test"
                    }
                })
                    .then(function (response) {
                        console.log("Response", response);
                    },
                        function (err) { console.error("Execute error", err); });
            }

        }
        var draft = false;
        var clientIsLoaded = false;
        var google = new GoogleAPI();
        // google API
        gapi.load("client:auth2", function () {
            gapi.auth2.init({ client_id: "712979888110-4471m7m95b4m5u269stfnbkpdthbtrcp.apps.googleusercontent.com" });
        });

        async function MakeAPost() {
            var title = document.getElementById('title').value;
            var content = document.getElementById('postcontent').value;
            console.log(title);
            google.execute(title, content, draft);
            console.log("Client is not loaded");

        }
        async function Authorize() {
            await google.authenticate();
            google.loadClient();

        }
        document.querySelector('.draft').addEventListener('click', function (e) {
            if (e.target.value == "draft") {
                draft = true;
            }
            else if (e.target.value == "notdraft") {
                draft = false;
            }
        });
        document.querySelector('#authorize').addEventListener('click', Authorize)
        document.querySelector('#submitpost').addEventListener('click', MakeAPost);

    </script>
    <!-- <script src="post.js"></script> -->

</body>

</html>